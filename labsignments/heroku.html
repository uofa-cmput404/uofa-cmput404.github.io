<!DOCTYPE html>
<html lang="en">
<head>
          <title>CMPUT 404 - Heroku Lab</title>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Web Applications and Architecture" />

  <link rel="icon" href="../theme/favicon.ico" />
  <link rel="stylesheet" type="text/css" href="../theme/style.css" />
  <link rel="stylesheet" type="text/css" href="../theme/404.css" />




    <meta name="tags" content="labs" />

</head>

<body>
        <header>
              <hgroup><h1><a href="../">CMPUT 404</a></h1><p>Web Applications and Architecture</p></hgroup>
        <nav><ul>
            <li><a href="/general/outline.html">Outline</a></li>
            <li><a href="/#eclass">eClass & Grades</a></li>
            <li><a href="/#schedule">Schedule</a></li>
            <li><a href="/general/labs.html">Labs</a></li>
            <li><a href="/general/project.html">Project</a></li>
            <li><a href="/general/individual.html">Participation</a></li>
            <li><a href="/general/resources.html">Resources</a></li>
            <li><a href="/general/help.html#discussion-forum">Discussion Forum</a></li>
            <li><a href="/#news-notices">News & Notices</a></li>
            <li><a href="/#lecture-zoom">Lecture Zoom</a></li>
            <li><a href="https://uofa-cmput404.github.io/slides-xt/">Slides</a></li>
            <li><a href="/general/help.html">Help</a></li>
        </ul></nav>
        </header>
        <main>
<article>
  <header>
    <h2>
      <a href="../labsignments/heroku.html" rel="bookmark"
         title="Permalink to Heroku Lab">Heroku Lab</a></h2>
 
  </header>
  <hr>
<div class="toc">
<ul>
<li><a href="#description">Description</a><ul>
<li><a href="#learning-goals">Learning Goals</a></li>
<li><a href="#warning">Warning!</a></li>
</ul>
</li>
<li><a href="#getting-started">Getting Started</a><ul>
<li><a href="#prepare-your-repo">Prepare your Repo</a></li>
<li><a href="#create-the-virtual-environment">Create the Virtual Environment</a><ul>
<li><a href="#if-you-have-multiple-versions-of-python-installed">If you have multiple versions of python installed:</a></li>
<li><a href="#check-if-you-have-pip">Check if you have pip</a></li>
<li><a href="#check-if-you-have-venv-or-virtualenv">Check if you have venv or virtualenv</a></li>
<li><a href="#if-you-dont-have-venv-or-virtualenv">If you don't have venv or virtualenv:</a></li>
<li><a href="#create-a-virtual-environment">Create a Virtual Environment</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#lab-instructions">Lab Instructions</a><ul>
<li><a href="#phase-one-django-polls-app">Phase One: Django Polls App</a><ul>
<li><a href="#creating-a-django-project">Creating a Django Project</a></li>
<li><a href="#creating-a-django-app">Creating a Django App</a></li>
<li><a href="#working-with-models">Working with Models</a></li>
<li><a href="#using-django-admin">Using Django Admin</a><ul>
<li><a href="#task-create-example-multiple-choice-questions">TASK - Create Example Multiple Choice Questions</a></li>
</ul>
</li>
<li><a href="#working-with-views">Working with Views</a></li>
<li><a href="#making-views-render-model-data">Making Views Render Model Data</a></li>
<li><a href="#namespacing-url-names">Namespacing URL Names</a></li>
<li><a href="#writing-a-simple-form">Writing a Simple Form</a></li>
<li><a href="#refactoring-generic-views">Refactoring: Generic Views</a></li>
<li><a href="#serializing-and-deserializing-queries">Serializing and Deserializing Queries</a></li>
<li><a href="#creating-a-serializer-class">Creating a Serializer Class</a></li>
<li><a href="#update-our-views-using-our-serializer">Update our views using our Serializer</a></li>
<li><a href="#updating-the-our-urls-for-the-new-views">Updating the our URLs for the new views</a></li>
<li><a href="#updating-a-question-using-our-serializer">Updating a Question Using our Serializer</a></li>
<li><a href="#other-cool-things-to-know">Other cool things to know</a></li>
<li><a href="#more-information-about-drf">More information about DRF</a></li>
<li><a href="#optionaloutside-of-lab">Optional/Outside of Lab</a></li>
</ul>
</li>
<li><a href="#phase-two-heroku">Phase Two: Heroku</a><ul>
<li><a href="#setting-up-the-heroku-cli">Setting up the Heroku CLI</a></li>
<li><a href="#preparing-our-django-application-for-heroku">Preparing our Django Application for Heroku</a></li>
<li><a href="#deploying-our-django-application-to-heroku">Deploying our Django Application to Heroku</a></li>
<li><a href="#using-a-postgres-database-on-heroku">Using a Postgres Database on Heroku</a></li>
<li><a href="#checking-your-heroku-app">Checking your heroku app</a></li>
</ul>
</li>
<li><a href="#phase-three-more-features">Phase Three: More Features</a><ul>
<li><a href="#task-question-creation-route">TASK - Question Creation Route</a></li>
<li><a href="#task-comment-section">TASK - Comment Section</a></li>
<li><a href="#task-markdown-comments">TASK - Markdown Comments</a></li>
<li><a href="#task-add-some-multiple-choice-questions-on-heroku">TASK - Add Some Multiple Choice Questions on Heroku</a></li>
<li><a href="#deploy-again">Deploy Again</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#restrictions">Restrictions</a></li>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#submission-instructions">Submission Instructions</a></li>
<li><a href="#collaboration">Collaboration</a></li>
<li><a href="#tips">Tips</a></li>
</ul>
</div>
<h3 id="description">Description</h3>
<p>This lab contains three phases. In Phase one, you will build a simple Django website. Understand the fundamentals of Django's MVC architecture using the built-in models and views.</p>
<p>In Phase two, you will deploy the Django application to <a href="https://www.heroku.com/">Heroku</a>. Understand the reasoning behind Platform as a Service (PaaS) businesses like Heroku. You may follow the official documentation.</p>
<p>In Phase three, you will apply the lab material to add a new API route and a comment section to your polls application!</p>
<h4 id="learning-goals">Learning Goals</h4>
<ul>
<li>Using esbuild to bundle and create static files with NPM packages for Django to server using whitenoise from Heroku.</li>
<li>Django config (Level 2)</li>
<li>Django routes (Level 2)</li>
<li>Django models (Level 2)</li>
<li>Using Django with Postgres backend on Heroku</li>
<li>Using Django with Sqlite backend for local testing</li>
</ul>
<h4 id="warning">Warning!</h4>
<p class="longWarning">
There will be no walkthrough for this lab. <strong>PLEASE MAKE SURE YOUR CODE IS WELL COMMENTED!</strong> This will help the TAs to be able to understand your code when they are marking your lab.
</p>

<!-- They aren't walking us through this lab bc of holidays. -->

<p>This <em>might</em> affect your Heroku domain. The University's firewall is also inconsistent so it doesn't <em>always</em> seem to do this.
IST is looking into it, but, I don't know how long that will take. IST claims that this firewall
triggers after "a proprietary amount of activity." So, please expect that <strong>your Heroku could become blocked by UWS at any time.</strong> We will <strong>not</strong> give you an extension if your Heroku is blocked.</p>
<!-- Double check that your Heroku is not blocked before your walkthrough. -->

<p>You have several options to make sure this doesn't happen:</p>
<ul>
<li>Bypass the University's DNS server by adding the hostname and IP address of your Heroku site to your hosts file.<ul>
<li>Follow the steps of the "Checking your Heroku app" below.</li>
<li>Then add it your hosts file:<ul>
<li>It uses the format <code>ip-address host-name host-name</code> on each line.<ul>
<li>Example (has CNAME): <code>46.137.15.86 ie02.ingress.herokuapp.com example-app-1234567890ab.herokuapp.com</code></li>
<li>Example (no CNAME): <code>34.201.81.34 lab3test-fbb81150e720.herokuapp.com</code></li>
</ul>
</li>
<li>Linux: edit /etc/hosts as superuser.</li>
<li>macOS: <a href="https://kinsta.com/knowledgebase/edit-mac-hosts-file/">https://kinsta.com/knowledgebase/edit-mac-hosts-file/</a></li>
<li>Windows 10/11: <a href="https://allthings.how/how-to-edit-hosts-file-in-windows-11/">https://allthings.how/how-to-edit-hosts-file-in-windows-11/</a></li>
</ul>
</li>
<li>If it stops working check again with nslookup and update it.</li>
</ul>
</li>
<li>Use a VPN service or proxy.</li>
<li>Walkthrough us your lab over using another internet not provided by the University while in the lab.</li>
<li>Windows: <a href="https://learn.microsoft.com/en-us/windows-server/networking/dns/doh-client-support">enable DoH</a>.</li>
<li>Firefox: <a href="https://support.mozilla.org/en-US/kb/firefox-dns-over-https">enable DoH</a>.</li>
<li>Chrome: <a href="https://simpledns.plus/kb/195-how-to-enable-dns-over-https-doh-in-chrome">enable DoH</a><ul>
<li>Edge: Should be similar to chrome.</li>
<li>Other chrome-based browsers: should be similar to chrome.</li>
</ul>
</li>
</ul>
<h3 id="getting-started">Getting Started</h3>
<h4 id="prepare-your-repo">Prepare your Repo</h4>
<ol>
<li>Get the GitHub classroom link from eClass, create your assignment, and clone it.</li>
<li>Create an appropriate <code>.gitignore</code> file, to prevent unwanted files being commited to your repository.</li>
</ol>
<p>Place this gitignore within the root of your project. You can combine <a href="https://github.com/github/gitignore/blob/main/Python.gitignore">this one</a> and <a href="https://github.com/github/gitignore/blob/main/Node.gitignore">this one</a> and <a href="https://github.com/django/django/blob/main/.gitignore">this one</a> for your django+node project. Double check you're not staging any unwanted files before you commit. The <code>git status</code> command can help with that.</p>
<p>Make sure your <code>.gitignore</code> contains <code>*.sqlite3</code>.</p>
<h4 id="create-the-virtual-environment">Create the Virtual Environment</h4>
<p>Virtual environment is a CLI tool for managing python dependencies. Different projects have different dependencies, and version requirements. A virtual environment allows you to manage your dependencies specific to your project.</p>
<h5 id="if-you-have-multiple-versions-of-python-installed">If you have multiple versions of python installed:</h5>
<p>Always end the python command with the version number. </p>
<p>For example, on the undergrad machines ugXX.cs.ualberta.ca: you can use <code>python3.11</code>.</p>
<h5 id="check-if-you-have-pip">Check if you have pip</h5>
<p><code>python3.XX -m pip</code> should give information about how to use pip.</p>
<p>For example, on the undergrad machines ugXX.cs.ualberta.ca: you can use <code>python3.11 -m pip</code>.</p>
<h5 id="check-if-you-have-venv-or-virtualenv">Check if you have venv or virtualenv</h5>
<p><code>python3.XX -m venv --help</code> should give information about how to use venv.</p>
<p>If you don't have <code>venv</code>, try <code>virtualenv</code>: <code>python -m virtualenv --help</code> should give information about how to use virtualenv.</p>
<p>For example, on the undergrad machines ugXX.cs.ualberta.ca: you can use <code>python3.11 -m venv --help</code>.</p>
<h5 id="if-you-dont-have-venv-or-virtualenv">If you don't have venv or virtualenv:</h5>
<ol>
<li>Run <code>python3.XX -m pip install --user virtualenv</code></li>
<li>Check installation: <code>python -m virtualenv --help</code> </li>
</ol>
<p>For more info check <a href="https://virtualenv.pypa.io/en/latest/installation.html">here</a>.</p>
<h5 id="create-a-virtual-environment">Create a Virtual Environment</h5>
<ol>
<li><code>python3.XX -m virtualenv venv</code> (or <code>python3.XX -m venv venv</code>)</li>
<li><code>source venv/bin/activate</code> (or <code>cd venv/scripts &amp;&amp; activate.bat</code> if you're on Windows)</li>
</ol>
<p>The first command will create a directory named <code>venv</code>. Contained in the directory is your project dependency installations and the <code>activate</code> script to enter the virtual environment. When you want to exit the environment, run <code>deactivate</code>.</p>
<h3 id="lab-instructions">Lab Instructions</h3>
<h4 id="phase-one-django-polls-app">Phase One: Django Polls App</h4>
<p><strong>For phase one of this lab,</strong> you will be creating a polls application that allows end users to be able to create and be able to answer multiple choice polls.</p>
<h5 id="creating-a-django-project">Creating a Django Project</h5>
<ul>
<li>Based on Official Docs <a href="https://docs.djangoproject.com/en/5.0/intro/overview/">Overview</a>, <a href="https://docs.djangoproject.com/en/5.0/intro/install/">Installation</a></li>
</ul>
<p>Make sure to use a <strong>virtual environment</strong> for this lab and that it is activated as shown above!</p>
<div class="highlight"><pre><span></span><code>echo &quot;Django&gt;=5.0.1&quot; &gt; requirements.txt
python3.11 -m pip install -r requirements.txt
</code></pre></div>

<p><strong>If you are encountering an issue with this command in regards to a library called <code>html5lib</code> you will need to update your pip version first.</strong></p>
<div class="highlight"><pre><span></span><code>wget https://bootstrap.pypa.io/get-pip.py -O ./get-pip.py
python3.11 ./get-pip.py
</code></pre></div>

<p>If you're doing this on <strong>Windows</strong> please make sure to follow the Windows
instructions for Lab 1 before starting this lab!</p>
<p>You can tell Django is installed and which version by running the following command in a shell prompt:</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>django<span class="w"> </span>--version
</code></pre></div>

<p>Initialize a new Django project in your repo.</p>
<aside class="option1">
<p>Recommended option: Django project in root of repo.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># We are creating a project named &quot;lab3&quot; in the relative directory &quot;.&quot; (our current directory)</span>
django-admin<span class="w"> </span>startproject<span class="w"> </span>lab3<span class="w"> </span>.

<span class="c1"># The manage.py file is a script included in all Django projects that lets you run various tasks (e.g. starting the server)</span>
python<span class="w"> </span>manage.py<span class="w"> </span>runserver
</code></pre></div>

<p>Your repo should look like this:</p>
<div class="highlight"><pre><span></span><code>.
├── lab3
│   ├── __init__.py
│   ├── asgi.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
└── manage.py
</code></pre></div>

</aside>
<aside class="option2">
<p>Alternate option: Django project in folder.</p>
<p>If you do <code>django-admin startproject lab3</code> (with no <code>.</code>) before that's fine, but your django project will be in folder in your git repo, so you will
need to use the noted alternate instructions. Your repo would look like this, with a <code>lab3</code> folder inside of a <code>lab3</code> folder.</p>
<p>You will need to be inside the <code>lab3</code> folder to run manage.py.</p>
<div class="highlight"><pre><span></span><code>.
└── lab3
    ├── lab3
    │   ├── __init__.py
    │   ├── asgi.py
    │   ├── settings.py
    │   ├── urls.py
    │   └── wsgi.py
    └── manage.py
</code></pre></div>

</aside>
<p>Now that the server’s running, visit <a href="http://localhost:8000/">http://localhost:8000/</a> with your web browser. You’ll see a “Congratulations!” page, with a rocket taking off. It worked!</p>
<hr>
<h5 id="creating-a-django-app">Creating a Django App</h5>
<ul>
<li>Based on Official Docs <a href="https://docs.djangoproject.com/en/5.0/intro/tutorial01/">Part 1</a> (Naming may vary)</li>
</ul>
<p>Create a new application within your django project called <strong>polls</strong>.</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>manage.py<span class="w"> </span>startapp<span class="w"> </span>polls
</code></pre></div>

<p>Create a file at <em>polls/urls.py</em> with the following code. This will handle incoming traffic to the <code>polls/</code> route that we will be creating in this phase of this lab.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="c1"># urlpatterns contains all of the routes that this application supports routing for.</span>
<span class="c1"># this routes traffic from polls/ to the index function that we defined earlier in the views file.</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<p>We will need also need to add a index view for our polls application when it receives traffic at <code>polls/</code>. Modify the <em>polls/views.py</em> file to look like the following.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="c1"># Later on, the index function will be used to handle incoming requests to polls/ and it will return the hello world string shown below.</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;Hello, world. You&#39;re at the polls index.&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Within <code>lab3/urls.py</code>, we need to modify it to route traffic to our newly added <code>polls/views.py</code>. replace it with the following code.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span>

<span class="c1"># this urlpatterns is different from the polls urlpatterns because lab3 is a project rather than an app. </span>
<span class="c1"># This urls.py is the base and forwards requests to the urls.py of the applications</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;polls/&quot;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s2">&quot;polls.urls&quot;</span><span class="p">)),</span>  <span class="c1"># All requests sent to polls/ should be handled by polls/urls.py</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;admin/&quot;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>    <span class="c1"># Django has a built in admin panel we will use later</span>
<span class="p">]</span>
</code></pre></div>

<p>Run the Django project with the runserver command.</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>manage.py<span class="w"> </span>runserver
</code></pre></div>

<p>Go to <a href="http://localhost:8000/polls/">http://localhost:8000/polls/</a> in your browser, and you should see the text “Hello, world. You’re at the polls index.”, which you defined in the index view.</p>
<p>If you get an error page here, check that you’re going to <a href="http://localhost:8000/polls/">http://localhost:8000/polls/</a> and not <a href="http://localhost:8000/">http://localhost:8000/</a>.</p>
<hr>
<h5 id="working-with-models">Working with Models</h5>
<ul>
<li>Based on Official Docs <a href="https://docs.djangoproject.com/en/5.0/intro/tutorial02/">Part 2</a></li>
</ul>
<p>Time to create our first models for our polls application. Open up <em>settings.py</em> and ensure that the default database is set to <code>sqlite3</code>.</p>
<p>It should look like this:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Database</span>
<span class="c1"># https://docs.djangoproject.com/en/5.0/ref/settings/#databases</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">&#39;db.sqlite3&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Within <em>polls/models.py</em> include the following code. Django's ORM allows you to define the properties you want stored in the database for a specific object (you can think of this as like an SQL table!) and provides you the ability to store, retrieve, and delete data from your Django database without having to write the database-specific code yourself. The attributes defined in each class represent the data fields that the model should store in the database.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">MultipleChoiceQuestion</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">question_text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>    <span class="c1"># Store the question in a char field in the database</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="s2">&quot;date published&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>   <span class="c1"># Store the published date in a datetime field in the database</span>

<span class="k">class</span> <span class="nc">MultipleChoiceOption</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">MultipleChoiceQuestion</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>  <span class="c1"># All multiple choice options belong to a multiple choice question</span>
    <span class="n">choice_text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>  <span class="c1"># Store the text for this option in the database</span>
    <span class="n">votes</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>          <span class="c1"># Store the amount of votes this choice has received</span>
</code></pre></div>

<p>With this, we are creating both a <code>MultipleChoiceQuestion</code> and <code>MultipleChoiceOption</code> model. Multiple Choice Questions have options to choose from. Because this is a RDBMS, each <code>MultipleChoiceOption</code> links to a specific <code>MultipleChoiceQuestion</code> instance. Which is why we use <code>models.ForeignKey</code> to specify a foreign reference to the <code>MultipleChoiceQuestion</code> model. For more information, you can check out the official documentation <a href="https://docs.djangoproject.com/en/5.1/topics/db/examples/many_to_one/">here</a>.</p>
<p>To activate our poll application in our project, we need to add it to the installed apps within <code>lab3/settings.py</code>. </p>
<div class="highlight"><pre><span></span><code><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;polls&quot;</span><span class="p">,</span>   <span class="c1"># Include this line in your INSTALLED_APPS variable!</span>
    <span class="s2">&quot;django.contrib.admin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.contenttypes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.sessions&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.messages&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.staticfiles&quot;</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div>

<p>Make the database migrations.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Database migrations are responsible for applying your model definitions to the actual database! It&#39;s important to note that this does not modify your database yet.</span>
python<span class="w"> </span>manage.py<span class="w"> </span>makemigrations<span class="w"> </span>polls
</code></pre></div>

<p>You should see something similar to the following:</p>
<div class="highlight"><pre><span></span><code>Migrations<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;polls&#39;</span>:
<span class="w">  </span>polls/migrations/0001_initial.py
<span class="w">    </span>-<span class="w"> </span>Create<span class="w"> </span>model<span class="w"> </span>Question
<span class="w">    </span>-<span class="w"> </span>Create<span class="w"> </span>model<span class="w"> </span>Choice
</code></pre></div>

<p>Run the migration command to create the tables in your database.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># This command takes the migrations we created earlier to modify the database, and applies them to the actual database.</span>
python<span class="w"> </span>manage.py<span class="w"> </span>migrate
</code></pre></div>

<p>Each Django project starts out using the default SQLite3 database provider, and that data is stored in the <code>db.sqlite3</code> file. Make sure your <code>.gitignore</code> contains <code>*.sqlite3</code>, and that you commit your change so that your <code>db.sqlite3</code> does not get pushed to your github repo.</p>
<h5 id="using-django-admin">Using Django Admin</h5>
<p>Django comes with a builtin admin dashboard that allows us to see and modify the model data that we have created. However, we need credentials in order to login to the admin dashboard. Run this command and to create a admin user that can log into the admin site. </p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>manage.py<span class="w"> </span>createsuperuser
</code></pre></div>

<p>You will be asked to enter your username, email, and password (twice for confirmation).</p>
<p>Make the polls app modifiable in the admin by editing the <em>polls/admin.py</em> file to be the following:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">MultipleChoiceOption</span><span class="p">,</span> <span class="n">MultipleChoiceQuestion</span>

<span class="c1"># These lines register your models with the django admin panel. If you do not include these lines, the data associated with these models will not be visible in your admin panel!</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MultipleChoiceQuestion</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MultipleChoiceOption</span><span class="p">)</span>
</code></pre></div>

<p>Start the development server again and go to <code>/admin</code> on your local domain – e.g., <a href="http://localhost:8000/admin/">http://localhost:8000/admin/</a>. You should see the admin’s login screen and can login with your admin account.</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>manage.py<span class="w"> </span>runserver
<span class="c1"># navigate to /admin</span>
</code></pre></div>

<p>After logging in, you should see both a <code>MultipleChoiceQuestion</code> and <code>MultipleChoiceOption</code> link.</p>
<h6 id="task-create-example-multiple-choice-questions">TASK - Create Example Multiple Choice Questions</h6>
<p>The admin panel lets us view our model data in a visual way, however we havent't created any new data! In the admin panel, click "+ Add" next to "Multiple choice questions" and create an example multiple choice question. Similarly, do the same process for "Multiple choice options", except to create options for the "Multiple choice options". </p>
<p><strong>Your task</strong> is to create some example <code>MultipleChoiceQuestion</code> and <code>MultipleChoiceOption</code> objects in the admin panel. This will be important later on as we create our poll application!</p>
<h5 id="working-with-views">Working with Views</h5>
<ul>
<li>Based on Official Docs <a href="https://docs.djangoproject.com/en/5.0/intro/tutorial03/">Part 3</a></li>
</ul>
<p>Now that we have some multiple choice questions in the database, let's implement some logic to actually see and answer our polls! Add some additional views to the <em>polls/views.py</em> file. Include the following functions:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># You&#39;ll notice that these functions include a question_id parameter in addition to the request parameter. The question_id parameter is user provided and is parsed from the url by the urlpatterns route in the next code snippet. </span>

<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>   <span class="c1"># http://localhost:8000/wiki/polls/5/</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;You&#39;re looking at question </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">question_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>  <span class="c1"># http://localhost:8000/wiki/polls/5/results/</span>
    <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;You&#39;re looking at the results of question </span><span class="si">%s</span><span class="s2">.&quot;</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">response</span> <span class="o">%</span> <span class="n">question_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">vote</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>     <span class="c1"># http://localhost:8000/wiki/polls/5/vote/</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;You&#39;re voting on question </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">question_id</span><span class="p">)</span>
</code></pre></div>

<p>With the above views added, add them to <em>polls/urls.py</em>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ex: http://localhost:8000/polls/</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">),</span>
    <span class="c1"># ex: http://localhost:8000/polls/5/</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&lt;int:question_id&gt;/&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">detail</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;detail&quot;</span><span class="p">),</span>
    <span class="c1"># ex: http://localhost:8000/polls/5/results/</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&lt;int:question_id&gt;/results/&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;results&quot;</span><span class="p">),</span>
    <span class="c1"># ex: http://localhost:8000/polls/5/vote/</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&lt;int:question_id&gt;/vote/&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">vote</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;vote&quot;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<p>Take a look in your browser, at <code>http://localhost:8000/polls/34/</code>. It’ll run the detail() function and display whatever ID you provide in the URL. Try <code>http://localhost:8000/polls/34/results/</code> and <code>http://localhost:8000/polls/34/vote/</code> too – these will display the placeholder results and voting pages.</p>
<hr>
<h5 id="making-views-render-model-data">Making Views Render Model Data</h5>
<p>Update the <em>polls/views.py</em> <code>index</code> method so the questions are returned.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Change the imports to this!</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">MultipleChoiceQuestion</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">latest_question_list</span> <span class="o">=</span> <span class="n">MultipleChoiceQuestion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-pub_date&quot;</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">q</span><span class="o">.</span><span class="n">question_text</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">latest_question_list</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

<span class="c1"># Leave the rest of the views (detail, results, vote) unchanged</span>
</code></pre></div>

<p>Create an empty directory named <em>templates</em> within <em>polls</em>. Then create another directory named <em>polls</em> within the <em>templates</em> directory. Lastly create a file called <em>index.html</em> within the second <em>polls</em> directory.</p>
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>polls/templates/polls
touch<span class="w"> </span>polls/templates/polls/index.html
</code></pre></div>

<p>Within the newly created empty <em>polls/templates/polls/index.html</em> file, write the following. This HTML template will iterate through every single question in the <code>latest_question_list</code> variable we created above, and render an HTML list element with a link to view the question!</p>
<div class="highlight"><pre><span></span><code>{% if latest_question_list %}
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    {% for question in latest_question_list %}
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/polls/{{ question.id }}/&quot;</span><span class="p">&gt;</span>{{ question.question_text }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    {% endfor %}
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
{% else %}
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>No polls are available.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
{% endif %}
</code></pre></div>

<p>Update the <code>index</code> view in <em>polls/views.py</em> to use the new template.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Change the imports to this!</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">MultipleChoiceQuestion</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">latest_question_list</span> <span class="o">=</span> <span class="n">MultipleChoiceQuestion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-pub_date&quot;</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;latest_question_list&quot;</span><span class="p">:</span> <span class="n">latest_question_list</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;polls/index.html&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="c1"># Do not modify the rest of the views</span>
</code></pre></div>

<p>If you goto <code>http://localhost:8000/polls/</code> you should be able to see a list of the questions that you had created in earlier in the lab in the admin panel!</p>
<p>Add a new template file for the poll details view.</p>
<div class="highlight"><pre><span></span><code>touch<span class="w"> </span>polls/templates/polls/detail.html
</code></pre></div>

<p>For the newly created template in <em>polls/templates/polls/detail.html</em>, update the content with the HTML code for our question:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{{ question.question_text }}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>   <span class="cm">&lt;!-- Display the question&#39;s text --&gt;</span>
<span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
{% for choice in question.multiplechoiceoption_set.all %}
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>{{ choice.choice_text }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>   <span class="cm">&lt;!-- Display each option&#39;s text --&gt;</span>
{% endfor %}
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</code></pre></div>

<p>Update the <code>detail</code> view in <em>polls/views.py</em> to use the new template.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Change the imports to this!</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">MultipleChoiceQuestion</span>

<span class="c1"># ...</span>

<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">MultipleChoiceQuestion</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">question_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;polls/detail.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;question&quot;</span><span class="p">:</span> <span class="n">question</span><span class="p">})</span>
</code></pre></div>

<p>Remove the hardcoded urls that we specified in the <em>polls/templates/polls/index.html</em> file and replace it with a template tag referencing our url.</p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- old --&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/polls/{{ question.id }}/&quot;</span><span class="p">&gt;</span>{{ question.question_text }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- new --&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;detail&#39; question.id %}&quot;</span><span class="p">&gt;</span>{{ question.question_text }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</code></pre></div>

<hr>
<h5 id="namespacing-url-names">Namespacing URL Names</h5>
<p>As a general good practice, you should always namespace your urls so that it is easier to reference specific paths in the case of a conflict between two apps. e.g. imagine if I also had path named <code>index</code> in another app called <code>poll2</code>. For functions that depend on the name of a specific path being passed. (E.g. when redirecting to a specific path <code>redirect("index")</code>) having that namespace allows for the two apps to share the same view name, but still allow functions that depend on specific paths to resolve to their correct app implementation. (e.g. for redirecting, I could specify <code>redirect("polls:index")</code> or <code>redirect("polls2:index")</code> depending on which app's index path I want to redirect to)</p>
<p>Add an <code>app_name</code> in the <em>polls/urls.py</em> file to set the application namespace.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">app_name</span> <span class="o">=</span> <span class="s2">&quot;polls&quot;</span>  <span class="c1"># Add me!</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&lt;int:question_id&gt;/&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">detail</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;detail&quot;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&lt;int:question_id&gt;/results/&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;results&quot;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&lt;int:question_id&gt;/vote/&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">vote</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;vote&quot;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<p>Change your <em>polls/index.html</em> template to point at the namespaced detail view.</p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- old --&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;detail&#39; question.id %}&quot;</span><span class="p">&gt;</span>{{ question.question_text }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- new --&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;polls:detail&#39; question.id %}&quot;</span><span class="p">&gt;</span>{{ question.question_text }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</code></pre></div>

<hr>
<h5 id="writing-a-simple-form">Writing a Simple Form</h5>
<ul>
<li>Based on Official Docs <a href="https://docs.djangoproject.com/en/5.0/intro/tutorial04/">Part 4</a></li>
</ul>
<p>While it's great that we can now see a list of all questions we've created, we still don't have a way of actually submitting one of our questions! Update the <em>polls/templates/polls/detail.html</em> file to match the following:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{% url &#39;polls:vote&#39; question.id %}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
    {% csrf_token %}
    <span class="p">&lt;</span><span class="nt">fieldset</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">legend</span><span class="p">&gt;&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{{ question.question_text }}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;&lt;/</span><span class="nt">legend</span><span class="p">&gt;</span>
        {% if error_message %}<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{ error_message }}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>{% endif %}
        {% for choice in question.multiplechoiceoption_set.all %}
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;radio&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;choice&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;choice{{ forloop.counter }}&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{ choice.id }}&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;choice{{ forloop.counter }}&quot;</span><span class="p">&gt;</span>{{ choice.choice_text }}<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        {% endfor %}
    <span class="p">&lt;/</span><span class="nt">fieldset</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Vote&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></div>

<p>Remember, earlier we created a url for the polls application in <em>polls/urls.py</em> that includes this line:</p>
<div class="highlight"><pre><span></span><code><span class="n">path</span><span class="p">(</span><span class="s1">&#39;&lt;int:question_id&gt;/vote/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">vote</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;vote&#39;</span><span class="p">),</span>
</code></pre></div>

<p>We also created a dummy implementation of the <code>vote()</code> function in <em>polls/views.py</em>. Let’s update the <code>vote</code> view in <em>polls/views.py</em> to handle the new template and allow us to vote on our questions.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Change the imports to this!</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">MultipleChoiceQuestion</span><span class="p">,</span> <span class="n">MultipleChoiceOption</span>

<span class="c1"># ...</span>
<span class="k">def</span> <span class="nf">vote</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">MultipleChoiceQuestion</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">question_id</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">selected_choice</span> <span class="o">=</span> <span class="n">question</span><span class="o">.</span><span class="n">multiplechoiceoption_set</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s2">&quot;choice&quot;</span><span class="p">])</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">MultipleChoiceOption</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">):</span>
        <span class="c1"># Redisplay the question voting form.</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="s2">&quot;polls/detail.html&quot;</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;question&quot;</span><span class="p">:</span> <span class="n">question</span><span class="p">,</span>
                <span class="s2">&quot;error_message&quot;</span><span class="p">:</span> <span class="s2">&quot;You didn&#39;t select a choice.&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">selected_choice</span><span class="o">.</span><span class="n">votes</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">selected_choice</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="c1"># Always return an HttpResponseRedirect after successfully dealing</span>
        <span class="c1"># with POST data. This prevents data from being posted twice if a</span>
        <span class="c1"># user hits the Back button.</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;polls:results&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">question</span><span class="o">.</span><span class="n">id</span><span class="p">,)))</span>
</code></pre></div>

<p>After voting, the application should redirect to a view displaying the results. Update the <code>results</code> view in <em>polls/views.py</em></p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">MultipleChoiceQuestion</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">question_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;polls/results.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;question&quot;</span><span class="p">:</span> <span class="n">question</span><span class="p">})</span>
</code></pre></div>

<p>Create a template for the results in <em>polls/templates/polls/results.html</em></p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{{ question.question_text }}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
{% for choice in question.multiplechoiceoption_set.all %}
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>{{ choice.choice_text }} -- {{ choice.votes }} vote{{ choice.votes|pluralize }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
{% endfor %}
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;polls:detail&#39; question.id %}&quot;</span><span class="p">&gt;</span>Vote again?<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></div>

<p>Run your application. Use the admin interface to create aquestion, then create multiple choices for your question. Navigate back to <code>polls/</code> and attempt to use your application.</p>
<hr>
<h5 id="refactoring-generic-views">Refactoring: Generic Views</h5>
<p>To convert the <code>poll</code> application to use generic views rather than function views, we will:</p>
<ol>
<li>Convert the old url conf.</li>
<li>Delete some of the old, unnecessary views.</li>
<li>Introduce new views based on Django's generic views.</li>
</ol>
<p>Amend the <em>polls/urls.py</em> url configuration. Note that the name of the matched pattern in the path strings of the second and third patterns has changed from <code>&lt;question_id&gt;</code> to <code>&lt;pk&gt;</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">app_name</span> <span class="o">=</span> <span class="s2">&quot;polls&quot;</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">IndexView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&lt;int:pk&gt;/&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">DetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;detail&quot;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&lt;int:pk&gt;/results/&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">ResultsView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;results&quot;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&lt;int:question_id&gt;/vote/&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">vote</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;vote&quot;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<p>Amend the <em>polls/views.py</em> file.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponseRedirect</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.views</span> <span class="kn">import</span> <span class="n">generic</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">MultipleChoiceQuestion</span><span class="p">,</span> <span class="n">MultipleChoiceOption</span>

<span class="k">class</span> <span class="nc">IndexView</span><span class="p">(</span><span class="n">generic</span><span class="o">.</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;polls/index.html&quot;</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s2">&quot;latest_question_list&quot;</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the last five published questions.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MultipleChoiceQuestion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-pub_date&quot;</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">DetailView</span><span class="p">(</span><span class="n">generic</span><span class="o">.</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MultipleChoiceQuestion</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s2">&quot;question&quot;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;polls/detail.html&quot;</span>

<span class="k">class</span> <span class="nc">ResultsView</span><span class="p">(</span><span class="n">generic</span><span class="o">.</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">MultipleChoiceQuestion</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s2">&quot;question&quot;</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;polls/results.html&quot;</span>

<span class="k">def</span> <span class="nf">vote</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>
    <span class="o">...</span>  <span class="c1"># same as above, no changes needed.</span>
</code></pre></div>

<hr>
<h5 id="serializing-and-deserializing-queries">Serializing and Deserializing Queries</h5>
<p>Based from the DRF (Django Rest Framework) tutorial <a href="https://www.django-rest-framework.org/tutorial/1-serialization/">here</a></p>
<p>To convert your queries to or from a JSON object you can use Django's serializers to serialize or deserialize Django QuerySets to or from JSON objects.  </p>
<p>First install the Django Rest Framework library using <code>pip</code> and make sure to update our <code>requirements.txt</code> file</p>
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>djangorestframework
pip<span class="w"> </span>freeze<span class="w"> </span>&gt;<span class="w"> </span>requirements.txt
</code></pre></div>

<p>Then add the <code>rest_framework</code> app to the <strong>BOTTOM</strong> of our <code>INSTALLED_APPS</code> in our <code>settings.py</code> file</p>
<div class="highlight"><pre><span></span><code><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="s1">&#39;rest_framework&#39;</span>
<span class="p">]</span>
</code></pre></div>

<h5 id="creating-a-serializer-class">Creating a Serializer Class</h5>
<p>Create a file in the <code>polls</code> directory named <code>serializers.py</code> and add the following</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">MultipleChoiceQuestion</span>

<span class="k">class</span> <span class="nc">QuestionSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">question_text</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span> <span class="c1"># This serializer expects a question_text char field</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>  <span class="c1"># This serializer expects a pub_date date time field</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and return a new `MultipleChoiceQuestion` instance, given the validated data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MultipleChoiceQuestion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">validated_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update and return an existing `MultipleChoiceQuestion` instance, given the validated data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">question_text</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;question_text&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">question_text</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pub_date&#39;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">pub_date</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">instance</span>
</code></pre></div>

<h5 id="update-our-views-using-our-serializer">Update our views using our Serializer</h5>
<p>Once you have the serializers you now need to write some API views using the new Serializer class</p>
<p>Edit the <code>polls/views.py</code> file, and add the following</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ADD these three imports!</span>
<span class="kn">from</span> <span class="nn">rest_framework.decorators</span> <span class="kn">import</span> <span class="n">api_view</span>
<span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
<span class="kn">from</span> <span class="nn">.serializers</span> <span class="kn">import</span> <span class="n">QuestionSerializer</span>

<span class="c1"># ...</span>

<span class="c1"># We are adding a new API route that lists question data in JSON format!</span>
<span class="nd">@api_view</span><span class="p">([</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_questions</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the list of questions on our website</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">questions</span> <span class="o">=</span> <span class="n">MultipleChoiceQuestion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">serializer</span> <span class="o">=</span> <span class="n">QuestionSerializer</span><span class="p">(</span><span class="n">questions</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>   <span class="c1"># many=True specifies that the input is not just a single question</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>

<p>The <code>@api_view</code> decorator will wrap the view so that only HTTP methods that are listed in the decorator will get executed.</p>
<h5 id="updating-the-our-urls-for-the-new-views">Updating the our URLs for the new views</h5>
<p>Because we want our API responses to have JSON objects we will have to add another set of urls with a <code>api/</code> prefix to our <code>polls/urls.py</code> file.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/questions/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">get_questions</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;get_questions&#39;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<p>Now run the project again with the <code>runserver</code> command and go to <code>polls/api/questions/</code></p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>manage.py<span class="w"> </span>runserver
</code></pre></div>

<p>You should see a list of question in a json format.</p>
<h5 id="updating-a-question-using-our-serializer">Updating a Question Using our Serializer</h5>
<p>We can use the serializer to update the <code>question_text</code> field of our question entries. Add another function to <code>polls/views.py</code></p>
<div class="highlight"><pre><span></span><code><span class="nd">@api_view</span><span class="p">([</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">update_question</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update a specific question</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">MultipleChoiceQuestion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">serializer</span> <span class="o">=</span> <span class="n">QuestionSerializer</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># partial=True means that not all required serializer properties are needed/given to the serializer.</span>
    <span class="k">if</span> <span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">serializer</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
</code></pre></div>

<p>and update the <code>polls/urls.py</code> file.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;api/question/&lt;int:pk&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">update_question</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;update_question&#39;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<p>Run the project using <code>runserver</code> and go to this link <code>polls/api/question/1</code> and POST the following information below.  </p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;question_text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Updated question text&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>After clicking the POST button you should see the updated value in the json structure above. The new value should also be reflected in the model admin page as well.</p>
<h5 id="other-cool-things-to-know">Other cool things to know</h5>
<ul>
<li>If your serializer is replicating a lot of information that's also contained in the model being (de)serialized then you can use the <code>ModelSerializer</code> class to automatically generate the fields and produce a simple default implementations for the <code>create()</code> and <code>update()</code> methods</li>
<li>If you want to support alternative serialization and deserialization styles then you can inherit the <code>BaseSerializer</code> class and override these four functions depending on what functionality you want the serializer class to support:</li>
<li><code>.to_representation()</code> - Override this to support serialization, for read operations</li>
<li><code>.to_internal_value()</code> - Override this to support deserialization, for write operations</li>
<li><code>.create()</code> and <code>.update()</code> - Override either or both of these to support saving instances.</li>
</ul>
<h5 id="more-information-about-drf">More information about DRF</h5>
<p>Her is the <a href="https://www.django-rest-framework.org/api-guide/serializers/">API Guide for Serializers</a></p>
<p>Here is the <a href="https://www.django-rest-framework.org/tutorial/1-serialization/">Tutorial guide</a></p>
<h5 id="optionaloutside-of-lab">Optional/Outside of Lab</h5>
<p>It is in your best interest to Work through the rest of Django's First Steps Tutorials:</p>
<ul>
<li><a href="https://docs.djangoproject.com/en/5.0/intro/tutorial05/">Part 5: Testing</a></li>
<li><a href="https://docs.djangoproject.com/en/5.0/intro/tutorial06/">Part 6: Static Files</a></li>
<li><a href="https://docs.djangoproject.com/en/5.0/intro/tutorial07/">Part 7: Customizing the Admin Site</a></li>
</ul>
<h4 id="phase-two-heroku">Phase Two: Heroku</h4>
<p><strong>For phase two of the lab,</strong> we will walk you through the deployment of your Django application onto Heroku.</p>
<h5 id="setting-up-the-heroku-cli">Setting up the Heroku CLI</h5>
<p>Sign up for a Heroku account at <a href="https://signup.heroku.com/">https://signup.heroku.com/</a>. Be sure to <strong>enable multi-factor authentication</strong> (two-factor authentication) or Heroku will not allow you to sign in. </p>
<p>You can apply for free Heroku credits for 12 months at <a href="https://www.heroku.com/github-students">https://www.heroku.com/github-students</a> with an eligible GitHub student account <a href="https://education.github.com/pack">https://education.github.com/pack</a>. <strong>We cannot guarantee that you will get free Heroku credits. As stated in the Course Outline, you may have to pay a small amount for Heroku.</strong></p>
<p>Note: Remember to clean up all Heroku resources after this course to avoid unexpected charges after exceeding the credit limit or the offer expires.</p>
<p>Download and install the <a href="https://devcenter.heroku.com/articles/heroku-cli#download-and-install">Heroku CLI tools</a>.</p>
<ul>
<li>Use the default installation instructions if you are on a VM or your own device.</li>
<li>If using a lab machine, download and extract the tarball and add the binary to your path.</li>
</ul>
<div class="highlight"><pre><span></span><code>wget<span class="w"> </span>https://cli-assets.heroku.com/channels/stable/heroku-linux-x64.tar.gz
tar<span class="w"> </span>-xvf<span class="w"> </span>heroku-linux-x64.tar.gz
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PATH</span><span class="s2">:</span><span class="nv">$HOME</span><span class="s2">/heroku/bin&quot;</span>
</code></pre></div>

<p>Ensure the heroku tool works, login to your account.</p>
<div class="highlight"><pre><span></span><code>heroku<span class="w"> </span>--version
<span class="c1"># heroku/8.7.1 linux-x64 node-v16.19.0</span>
heroku<span class="w"> </span>login
</code></pre></div>

<h5 id="preparing-our-django-application-for-heroku">Preparing our Django Application for Heroku</h5>
<p>Ensure the Django application created in Phase One is working locally.</p>
<p>Activate the virtualenv for the Django application.</p>
<aside class="option1">
Ensure that the git repo structure is similar to the following if you're not using a project folder:


<div class="highlight"><pre><span></span><code>$ tree 
.
├── Procfile    &lt;- you will create this in the next step
├── README.md
├── lab3
│   ├── __init__.py
│   ├── asgi.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
├── manage.py
├── polls
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── migrations
│   │   ├── 0001_initial.py
│   │   └── __init__.py
│   ├── models.py
│   ├── serializers.py
│   ├── templates
│   │   └── polls
│   │       ├── detail.html
│   │       ├── index.html
│   │       └── results.html
│   ├── tests.py
│   ├── urls.py
│   └── views.py
└── requirements.txt
</code></pre></div>


</aside>

<aside class="option2">
If you do have a project subfolder it should look like this:


<div class="highlight"><pre><span></span><code>.
├── Procfile    &lt;- you will create this in the next step
├── README.md
├── lab3
│   ├── lab3
│   │   ├── __init__.py
│   │   ├── asgi.py
│   │   ├── settings.py
│   │   ├── urls.py
│   │   └── wsgi.py
│   ├── manage.py
│   └── polls
│       ├── __init__.py
│       ├── admin.py
│       ├── apps.py
│       ├── migrations
│       │   ├── 0001_initial.py
│       │   └── __init__.py
│       ├── models.py
│       ├── serializers.py
│       ├── templates
│       │   └── polls
│       │       ├── detail.html
│       │       ├── index.html
│       │       └── results.html
│       ├── tests.py
│       ├── urls.py
│       └── views.py
└── requirements.txt
</code></pre></div>


</aside>

<p>Pip install <a href="https://gunicorn.org/">gunicorn</a>, <a href="https://github.com/evansd/whitenoise">whitenoise</a>, <a href="https://github.com/jazzband/dj-database-url/">dj-database-url</a>, and <a href="https://github.com/psycopg/psycopg2">psycopg2-binary</a>.</p>
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>gunicorn<span class="w"> </span>whitenoise<span class="w"> </span>dj-database-url<span class="w"> </span>psycopg2-binary
<span class="c1"># gunicorn is a production level HTTP Server library</span>
<span class="c1"># whitenoise is a static file hosting middleware library</span>
<span class="c1"># dj-database-url is a library used to format the database url provided by HEROKU to be formatted for Django</span>
<span class="c1"># psycopg2-binary is a database adapter library</span>
</code></pre></div>

<p>Save the new python requirements into the <em>requirements.txt</em> file.</p>
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>freeze<span class="w"> </span>&gt;<span class="w"> </span>requirements.txt
</code></pre></div>

<p><code>requirements.txt</code> must be in the root of your repo for Heroku to detect your project as a Python/Django project!</p>
<aside class="option1">
<p>Create a new file named <em>Procfile</em> for Heroku applications. The file shall have following contents:</p>
<div class="highlight"><pre><span></span><code>web: gunicorn lab3.wsgi
</code></pre></div>

</aside>
<aside class="option2">
<p>If your Django PROJECT (not app) is in a subfolder like <code>lab3</code>, then you will need to write something like:</p>
<div class="highlight"><pre><span></span><code>web: gunicorn lab3.wsgi --chdir lab3
</code></pre></div>

</aside>
<p>Within <em>settings.py</em>, add/edit the following statements:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Update this variable</span>
<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span>

<span class="c1"># Add at the bottom of the file</span>
<span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s2">&quot;staticfiles&quot;</span> 
<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s2">&quot;/static/&quot;</span>
</code></pre></div>

<p>and then edit the <code>MIDDLEWARE</code> list to have <code>whitenoise.middleware.WhiteNoiseMiddleware</code> right after <code>django.middleware.security.SecurityMiddleware</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s2">&quot;django.middleware.security.SecurityMiddleware&quot;</span><span class="p">,</span>
    <span class="s2">&quot;whitenoise.middleware.WhiteNoiseMiddleware&quot;</span><span class="p">,</span>
    <span class="c1"># ...</span>
<span class="p">]</span>
</code></pre></div>

<h5 id="deploying-our-django-application-to-heroku">Deploying our Django Application to Heroku</h5>
<p>First, <a href="https://dashboard.heroku.com/new-app">create an app</a> on your Heroku dashboard. Keep in mind that a Heroku app is different from a Django app.</p>
<p>Commit your files and deploy the application using a the heroku command line tool. See <a href="https://devcenter.heroku.com/articles/git">their article on how to do this</a>. Follow the instructions for an existing app, not a new app. Use <code>heroku git:remote</code>, <strong>NOT</strong> <code>heroku create</code>.
If you used <code>heroku create</code>, please see <a href="https://stackoverflow.com/questions/50421071/git-i-made-a-repository-inside-a-repository-and-now-i-just-want-the-one-big-rep">this stackoverflow question</a> about how to return to a single repository.</p>
<p>You should have a heroku app. You should see it if you run the <code>heroku list</code> command. <strong>In the following, <code>APPNAME</code> refers to this heroku app's name.</strong></p>
<h5 id="using-a-postgres-database-on-heroku">Using a Postgres Database on Heroku</h5>
<p>Heroku provides additional services in addition to project hosting. In this case, we will need to add a postgresql database to our app.</p>
<div class="highlight"><pre><span></span><code>heroku<span class="w"> </span>addons:create<span class="w"> </span>heroku-postgresql:essential-0<span class="w"> </span>--app<span class="w"> </span>APPNAME
</code></pre></div>

<p>You can manage your essentials-0 postgres on your heroku dashboard under the resources section &gt; add-ons.
<br><img id="access-panel" alt="access panel" src="../labsignments/postgres-add-on.png" style="width: 100%;"></p>
<p>Check that heroku is configuring the database: (You may need to wait a bit for the add-on to be installed)</p>
<div class="highlight"><pre><span></span><code>heroku<span class="w"> </span>run<span class="w"> </span><span class="s2">&quot;env&quot;</span><span class="w"> </span>--app<span class="w"> </span>APPNAME
</code></pre></div>

<p>You should get an output like that contains a line that starts with <code>DATABASE_URL=postgres://</code> followed by a username and a password.</p>
<p>We now need to update our code to support saving data on Heroku using this environment variable. Edit <code>settings.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># at the very top of the file</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">dj_database_url</span>

<span class="c1"># ...</span>

<span class="c1"># Replace the old DATABASES variable declaration with this if statement</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Running on Heroku</span>
    <span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">dj_database_url</span><span class="o">.</span><span class="n">config</span><span class="p">(</span>
            <span class="n">conn_max_age</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">conn_health_checks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ssl_require</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Running locally.</span>
    <span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ENGINE&quot;</span><span class="p">:</span> <span class="s2">&quot;django.db.backends.sqlite3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NAME&quot;</span><span class="p">:</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s2">&quot;db.sqlite3&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>

<p>Commit your files and deploy the application again using the heroku command line tool.</p>
<p>Once it is deployed, check that django is now using your heroku postgres database:</p>
<aside class="option1">
<div class="highlight"><pre><span></span><code><span class="c1"># If your django project is your git repo root</span>
heroku<span class="w"> </span>run<span class="w"> </span><span class="s2">&quot;python3 manage.py diffsettings&quot;</span><span class="w"> </span>--app<span class="w"> </span>APPNAME
</code></pre></div>

</aside>
<aside class="option2">
<div class="highlight"><pre><span></span><code><span class="c1"># If your django project is in a folder</span>
heroku<span class="w"> </span>run<span class="w"> </span><span class="s2">&quot;python3 lab3/manage.py diffsettings&quot;</span><span class="w"> </span>--app<span class="w"> </span>APPNAME
</code></pre></div>

</aside>
<p>The output should contain a line like this that says <code>'default'</code> and has <code>'ENGINE': 'django.db.backends.postgresql'</code>.</p>
<div class="highlight"><pre><span></span><code>DATABASES = {&#39;default&#39;: {&#39;NAME&#39;: &#39;random letters&#39;, &#39;USER&#39;: &#39;random letters&#39;, &#39;PASSWORD&#39;: &#39;big hex number&#39;, &#39;HOST&#39;: &#39;something.amazonaws.com&#39;, &#39;PORT&#39;: 5432, &#39;CONN_MAX_AGE&#39;: 600, &#39;CONN_HEALTH_CHECKS&#39;: False, &#39;ENGINE&#39;: &#39;django.db.backends.postgresql&#39;, &#39;OPTIONS&#39;: {&#39;sslmode&#39;: &#39;require&#39;}, &#39;ATOMIC_REQUESTS&#39;: False, &#39;AUTOCOMMIT&#39;: True, &#39;TIME_ZONE&#39;: None, &#39;TEST&#39;: {&#39;CHARSET&#39;: None, &#39;COLLATION&#39;: None, &#39;MIGRATE&#39;: True, &#39;MIRROR&#39;: None, &#39;NAME&#39;: None}}}
</code></pre></div>

<p>If it contains <code>sqlite3</code>, something is wrong. Please check that you followed the steps correctly.</p>
<p>Run your migrations, create a Superuser, and ensure your application functionality works.</p>
<aside class="option1">
<div class="highlight"><pre><span></span><code>heroku<span class="w"> </span>run<span class="w"> </span><span class="s2">&quot;python manage.py migrate&quot;</span><span class="w"> </span>--app<span class="w"> </span>APPNAME
heroku<span class="w"> </span>run<span class="w"> </span><span class="s2">&quot;python manage.py createsuperuser&quot;</span><span class="w"> </span>--app<span class="w"> </span>APPNAME
</code></pre></div>

</aside>
<aside class="option2">
<p>If your Django project is in a folder in your repo like <code>lab3</code>, you will need something like:</p>
<div class="highlight"><pre><span></span><code>heroku<span class="w"> </span>run<span class="w"> </span><span class="s2">&quot;python lab3/manage.py migrate&quot;</span><span class="w"> </span>--app<span class="w"> </span>APPNAME
heroku<span class="w"> </span>run<span class="w"> </span><span class="s2">&quot;python lab3/manage.py createsuperuser&quot;</span><span class="w"> </span>--app<span class="w"> </span>APPNAME
</code></pre></div>

</aside>
<p>After this if you select your postgres database in the <a href="https://data.heroku.com/dataclips/create">Heroku dataclips interface</a>, you should see your polls_question and poll_choice tables.</p>
<p>Go to <code>/polls</code> on your Heroku deployed site, you should be able to use the Polls app from Heroku. </p>
<p>Note: Please make sure that the Heroku app uses Postgres as the backend database. If you created the Heroku app through Git integration, this should be a default setting.</p>
<p>You can verify the backend in use by login into the dashboard of the Heroku app: <a href="https://dashboard.heroku.com/apps/APP_NAME">https://dashboard.heroku.com/apps/APP_NAME</a>, then click the <code>Resources</code> tab, you should see <code>Heroku Postgres</code> under the <code>Add-ons</code> Section.</p>
<p>If you try to create the Heroku app through the Heroku webpage, you can follow the below instructions to enable Postgres.
<a href="https://www.geeksforgeeks.org/deploying-django-app-on-heroku-with-postgres-as-backend/">https://www.geeksforgeeks.org/deploying-django-app-on-heroku-with-postgres-as-backend/</a></p>
<h5 id="checking-your-heroku-app">Checking your heroku app</h5>
<p>You can use the <code>heroku open --app APPNAME</code> command to open your heroku app in a web browser. </p>
<ul>
<li>Add your apps hostname, cname, and ip address to the README.md file in your git repo. You <strong>must</strong> do this to help us mark your work. <ul>
<li>First get your heroku apps hostname, it will look something like <code>example-app-1234567890ab.herokuapp.com</code>.</li>
<li>Then get an IP address for it using the <code>nslookup</code> command and a public dns server not controlled by the University.<ul>
<li>This will look something like <code>nslookup example-app-1234567890ab.herokuapp.com 1.1.1.1</code>.<ul>
<li>The second argument is the DNS server's IP address. You could also use:<ul>
<li><code>nslookup example-app-1234567890ab.herokuapp.com 8.8.8.8</code></li>
<li><code>nslookup example-app-1234567890ab.herokuapp.com 9.9.9.9</code><ul>
<li>Or any other <a href="https://duckduckgo.com/?t=ffab&amp;q=public+dns+servers&amp;ia=answer&amp;iax=answer">public DNS server</a>. <code>1.1.1.1</code> <code>8.8.8.8</code> and <code>9.9.9.9</code> are just easy to remember!</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Read the output of nslookup, it will say something like:<ul>
<li><code>example-app-1234567890ab.herokuapp.com  canonical name = ie02.ingress.herokuapp.com.</code></li>
<li><code>ie02.ingress.herokuapp.com</code></li>
<li><code>Address: 46.137.15.86</code></li>
</ul>
</li>
<li>Sometimes it doesn't have CNAME, this is fine:<ul>
<li><code>Name:   lab3test-fbb81150e720.herokuapp.com</code></li>
<li><code>Address: 34.201.81.34</code></li>
<li>In this case, write "none" for the cname.</li>
</ul>
</li>
<li>Write your app's hostname, cname, and ip address to the README.md in your git repo.</li>
</ul>
</li>
<li>Make sure you can use the admin panel on heroku from your web browser.<ul>
<li>Hint: shut down your localhost server if its running to make sure you're not connecting to the one on your computer by accident!</li>
<li>Use the admin panel to add a poll.</li>
</ul>
</li>
<li>Make sure you can use the polls app on heroku from your web browser.</li>
<li>Make sure your heroku app remembers the results of your polls and your superuser login!<ul>
<li>If your heroku is not configured properly to use postgres it will forget them randomly! (somewhere between 0 and 24 hours.)</li>
</ul>
</li>
</ul>
<h4 id="phase-three-more-features">Phase Three: More Features</h4>
<p>Congratulations on getting your app deployed to Heroku! Let's add some new features to your application for you to deploy as well!</p>
<h5 id="task-question-creation-route">TASK - Question Creation Route</h5>
<p>At this point in the lab, we should have a working poll application deployed on Heroku. However, we need a way to programmatically create questions without using the admin panel! </p>
<p><strong>Your task</strong> is to add a new api route at <code>polls/api/question/add/</code> that will add a new multiple choice question when a POST request is received! It should return a 405 when any other method is received. The post payload will contain a JSON object with the properties <code>question</code> and <code>answers</code>. </p>
<p><code>question</code> is a string that MUST be AT LEAST 1 character long and AT MOST 200 characters long. <code>answers</code> is a array of answers that MUST have at least 1 answer. Each answer MUST be AT LEAST 1 character long and AT MOST 200 characters long. </p>
<p>For example...</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;question&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Should pineapple be on pizza?&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;answers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;yes&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;no&quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p>This should create 1 <code>MultipleChoiceQuestion</code> and 2 <code>MultipleChoiceOption</code>s. </p>
<p>If a question or answer is not valid, (or if a <code>question</code> or <code>answers</code> is not provided) it should not create any <code>MultipleChoiceQuestion</code> or <code>MultipleChoiceOption</code> and return an appropriately erroring http status response.</p>
<p>You can return any response so long as the HTTP status code returned is 201.</p>
<p>An example CURL request you can use to test your API is:</p>
<div class="highlight"><pre><span></span><code>curl -X POST http://localhost:8000/polls/api/question/add/ \
    -H &quot;Content-Type: application/json&quot; \
    -d &#39;{&quot;question&quot;:&quot;Should pineapple be on pizza?&quot;, &quot;answers&quot;:[&quot;yes&quot;, &quot;no&quot;]}&#39;
</code></pre></div>

<p><strong>Task Requirements</strong></p>
<ul>
<li>MUST have a route available at <code>polls/api/question/add/</code> (e.g. localhost:8000/polls/api/question/add/)<ul>
<li>MUST only handle POST and return a 405 when any other method is received.</li>
</ul>
</li>
<li>MUST verify the payload is correct<ul>
<li>MUST check that <code>question</code> and <code>answers</code> were provided</li>
<li>MUST check that <code>question</code> is between 1-200 characters long</li>
<li>MUST check that each answer is between 1-200 characters long</li>
<li>MUST check that there is AT LEAST one answer in <code>answers</code></li>
<li>MUST check that each answer is at least 1 character long</li>
<li>MUST not create any models if any validation step fails</li>
<li>MUST return an appropriately erroring http status code if validation fails</li>
</ul>
</li>
<li>MUST create a <code>MultipleChoiceQuestion</code> and multiple <code>MultipleChoiceOption</code> when the payload is valid<ul>
<li>MUST respond with a status code of 201 after it was created</li>
</ul>
</li>
</ul>
<p><strong>Hint</strong>: You may find <code>rest_framework</code>'s serializers useful for doing the majority of the validation work for you! We also went through it earlier in the lab! (<a href="https://www.django-rest-framework.org/api-guide/serializers/">Documentation</a>)</p>
<h5 id="task-comment-section">TASK - Comment Section</h5>
<p>It feels a bit empty if we just have a poll page. So let's go ahead and add a comment section to each poll!</p>
<p>Add a new route in <code>polls/urls.py</code> to handle the form submission when a user submits the comment form to add a new comment.</p>
<div class="highlight"><pre><span></span><code><span class="n">path</span><span class="p">(</span><span class="s1">&#39;&lt;int:question_id&gt;/add_comment/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">add_comment</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;add_comment&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Update <code>polls/views.py</code> to have a new <code>add_comment</code> function that will handle the processing of the comment form.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add_comment</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>
    <span class="c1"># TODO: Your implementation here!</span>
    <span class="k">pass</span>
</code></pre></div>

<p>Next we need to update our <code>results.html</code> template to support rendering/adding comments. Replace the contents of <code>polls/results.html</code> file with be the following:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{{ question.question_text }}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
{% for choice in question.multiplechoiceoption_set.all %}
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>{{ choice.choice_text }} -- {{ choice.votes }} vote{{ choice.votes|pluralize }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
{% endfor %}
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;polls:detail&#39; question.id %}&quot;</span><span class="p">&gt;</span>Vote again?<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;border: 1px solid #000; margin: 20px 0 0 0; padding: 0 0 10px 10px;&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Add Comment<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{% url &#39;polls:add_comment&#39; question.id %}&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;font-weight: bold;&quot;</span><span class="p">&gt;</span>Username<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">maxlength</span><span class="o">=</span><span class="s">&quot;32&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;font-weight: bold;&quot;</span><span class="p">&gt;</span>Message<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;content&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;min-width: 400px; max-width: 400px;&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="p">/&gt;</span>
        {% csrf_token %}
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Comments<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;display: flex; flex-direction: column; gap: 10px;&quot;</span><span class="p">&gt;</span>
    {% for comment in question.comment_set.all %}
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;border: 1px solid #000; padding: 0 0 20px 10px;&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>{{ comment.username }} - {{ comment.created_at|date:&#39;Y/m/d H:i&#39; }}<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>{{ comment.content }}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    {% endfor %}
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>

<p><strong>Your task</strong> is to create a new <code>Comment</code> model with a <code>username</code> char field, a <code>created_at</code> date time field, and a <code>content</code> text field. It should also have a foreign key reference field to a <code>MultipleChoiceQuestion</code> that can be named anything you'd like. <strong>It is important that you do not change the model name or field names/types or else the template will likely not render your comments.</strong> The max length of the <code>username</code> field will be 32 characters.</p>
<p><strong>Secondly,</strong> you must handle the backend for validating and creating a new comment object when a <code>POST</code> request is sent and received at your <code>add_comment</code> endpoint that we created earlier in this task section. The post payload will contain a <code>username</code> and <code>content</code> that correspond to the two fields you see when you goto the results page of a poll. After creating the comment, the client should be redirected back to the poll result page so that they can see their new comment. <strong>If either property is blank or invalid,</strong> you should not create a new instance of the <code>Comment</code> model and instead just redirect back to the poll result page.</p>
<p><strong>Task Requirements</strong></p>
<ul>
<li>MUST create a <code>Comment</code> model with a...<ul>
<li><code>username</code> char field</li>
<li><code>created_at</code> date time field</li>
<li><code>content</code> text field</li>
<li>foreign key reference to the <code>MultipleChoiceQuestion</code> the comment belongs to</li>
</ul>
</li>
<li>MUST have a route available at <code>polls/question/&lt;id&gt;/add_comment/</code><ul>
<li>MUST create a new <code>Comment</code> if the <code>username</code> and <code>content</code> form fields passed to the request are valid<ul>
<li>If the fields are not provided/empty, it must not create a new <code>Comment</code></li>
</ul>
</li>
<li>MUST ensure the username field is at most 32 characters</li>
<li>MUST redirect back to the poll result page after processing the request</li>
</ul>
</li>
<li>MUST have comments be shown on results page after adding a new comment</li>
<li>MUST 404 if the question id provided is invalid</li>
</ul>
<h5 id="task-markdown-comments">TASK - Markdown Comments</h5>
<p>At this point in the lab, you should have a working comment section. Let's add markdown rendering to your comments! Similarly to the last lab, we will need to transpile a javascript file! </p>
<p>We will need to install <code>marked</code> and <code>esbuild</code> in our root repository directory again.</p>
<div class="highlight"><pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>--save-dev<span class="w"> </span>marked
npm<span class="w"> </span>install<span class="w"> </span>--save-dev<span class="w"> </span>esbuild
</code></pre></div>

<p>Create a new folder in the root repository directory called <code>webapp</code>, add a new file called <code>markdown-renderer.js</code>, and paste the following javascript code in it:</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">marked</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;marked&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Import the markdown converter</span>

<span class="c1">// Handle rendering</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">contentDivs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">contentDiv</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">contentDivs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">markdownText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contentDiv</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">htmlOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">marked</span><span class="p">(</span><span class="nx">markdownText</span><span class="p">);</span>
<span class="w">        </span><span class="nx">contentDiv</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">htmlOutput</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>

<p><strong>Your task</strong> is to run the transpilation command in the root repository directory so that we can make this JavaScript code ready for use in our browser!</p>
<div class="highlight"><pre><span></span><code><span class="c1"># If you ran django-admin startproject lab3 .</span>
npx<span class="w"> </span>esbuild<span class="w"> </span>./webapp/markdown-renderer.js<span class="w"> </span>--bundle<span class="w"> </span>--minify<span class="w"> </span>--sourcemap<span class="w"> </span>--outfile<span class="o">=</span>./polls/static/markdown-renderer.min.js

<span class="c1"># If you ran django-admin startproject lab3</span>
npx<span class="w"> </span>esbuild<span class="w"> </span>./webapp/markdown-renderer.js<span class="w"> </span>--bundle<span class="w"> </span>--minify<span class="w"> </span>--sourcemap<span class="w"> </span>--outfile<span class="o">=</span>./lab3/polls/static/markdown-renderer.min.js
</code></pre></div>

<p>Next, we need to include this javascript file into our HTML! Edit <code>templates/polls/results.html</code> and add at the top of the file</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="o">%</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="o">%</span><span class="p">}</span>
</code></pre></div>

<p>and at the bottom of the file</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{% static &#39;markdown-renderer.min.js&#39; %}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span> <span class="cm">&lt;!-- Load bundled JS --&gt;</span>
</code></pre></div>

<p>Congratulations! Your comment section should now have markdown support! You can test this by typing in a comment to any poll with the content <code>**this text should be bold!**</code> to see if your markdown renderer is working!</p>
<h5 id="task-add-some-multiple-choice-questions-on-heroku">TASK - Add Some Multiple Choice Questions on Heroku</h5>
<p><strong>Your task</strong> is to make sure that your Heroku instance has 2+ example multiple choice questions of your own choosing.</p>
<h5 id="deploy-again">Deploy Again</h5>
<p>After completing every task please make sure to commit your files and deploy the application using the heroku command line tool. See the <strong>Deploying our Django Application to Heroku</strong> section above for more information.</p>
<h3 id="restrictions">Restrictions</h3>
<p>Violation of the restrictions will result in a mark of zero.</p>
<ul>
<li>Must use Python3</li>
<li>Must run on Ubuntu (Use the undergrad lab machines, for example the ones in CSC 2-29 or install an Ubuntu VM to check this)</li>
<li>Must run on your machine (whatever machine you use to show us)</li>
<li>Must be running on heroku, with some polls that you created for the TA to look at when they mark it. </li>
</ul>
<h3 id="requirements">Requirements</h3>
<ul>
<li>A working Django 5 application<ul>
<li>using the latest Django version from pypi<ul>
<li>downloaded with pip into a virtualenv</li>
</ul>
</li>
<li>that is deployed on Heroku</li>
<li>using a heroku postgres database<ul>
<li>you can check what database is being used by the <code>heroku run "python3 manage.py diffsettings"</code> command above.</li>
</ul>
</li>
<li>with a polls homepage that displays all polls created at <code>/polls/</code><ul>
<li>must have at least 2+ multiple choice questions of your choosing</li>
</ul>
</li>
<li>with a poll vote page at <code>/polls/&lt;id&gt;/</code></li>
<li>with a poll results page at <code>/polls/&lt;id&gt;/results/</code><ul>
<li>must have a working comment section</li>
<li>must display comments in Markdown</li>
</ul>
</li>
<li>with a poll vote route at <code>/polls/&lt;id&gt;/vote/</code> that processes poll votes</li>
<li>with a poll comment route at <code>/polls/&lt;id&gt;/add_comment/</code> that adds and validates comments to a question<ul>
<li>must abide by all task requirements mentioned in <strong>TASK - Comment Section</strong> section</li>
</ul>
</li>
<li>with a api route available at <code>/polls/api/questions/</code> that displays the 5 most recently published questions</li>
<li>with a api route available at <code>/polls/api/question/&lt;id&gt;</code> that updates and validates new multiple choice question information</li>
<li>with a api route available at <code>/polls/api/question/add/</code> that creates and validates multiple choice questions<ul>
<li>must abide by all task requirements mentioned in <strong>TASK - Question Creation Route</strong> section</li>
</ul>
</li>
<li>using Django's ORM system to store database data</li>
</ul>
</li>
<li>A git repository that does not contain built (compiled, bundled) or downloaded artifacts, including but not limited to:<ul>
<li><code>virtualenv</code> <code>venv</code> etc.</li>
<li><code>.pyc</code> files, <code>__pycache__</code> directories.</li>
<li><code>node_modules</code></li>
<li><code>db.sqlite3</code> or any other databases.<ul>
<li><code>db.sqlite3</code> <em>should never leave your computer.</em> It is for local development only.</li>
</ul>
</li>
</ul>
</li>
<li>Your git repository SHOULD contain:<ul>
<li>The code you worked on during the lab.</li>
<li>Django migrations: <code>polls/migrations/0001_initial.py</code> etc.</li>
<li><code>README.md</code><ul>
<li>Has heroku app's hostname, cname, and IP address.<ul>
<li>cname can be "none" if nslookup doesn't give a cname.</li>
</ul>
</li>
</ul>
</li>
<li>Your transpiled <code>*.min.js</code>, and <code>*.min.js.map</code> files.</li>
</ul>
</li>
</ul>
<h3 id="submission-instructions">Submission Instructions</h3>
<p>Make sure you push to github classroom <strong>BEFORE 4PM on Monday!</strong> You will not be able to push after that!</p>
<p>Submit a link to your repo in the form <code>https://github.com/uofa-cmput404/w24-h0x-labsignment-heroku-yourgithubname</code> on eClass. <strong>Do not</strong> submit a link to a branch, a file, or the clone url. If you do not do this we will not know which github submission is yours.</p>
<p>After you receive your grade, you can delete your Heroku app to save credits/money.</p>
<h3 id="collaboration">Collaboration</h3>
<ul>
<li>You may consult with others (exchange high-level ideas) but the submission should be your own source code.</li>
<li>Collaboration must be documented in your source code.</li>
<li>Any source code you got from anywhere else must be cited in the source code.</li>
<li>You can only use source code that <strong>you understand</strong>: see the <a href="../general/labs.html#lab-marking">lab marking info</a></li>
</ul>
<h3 id="tips">Tips</h3>
<p>Django is a complex framework and maybe overwhelming at times. You should consult the documentation should you run into any issues with the framework. </p>
<p>If you're unable to load a static file or resource, it maybe because you're not referencing it correctly. It may be in a different directory or you have a typo when you are referencing that particular resource using its path. </p>
<p>Another common problem is not being able to render the templates even though you're directory structure is correct. Make sure your app is registered in <code>settings.py</code> otherwise it may not render.</p>
  <footer>
    <p>Published: <time datetime="2024-01-25T00:00:00-07:00">
      Thu, 25 Jan 2024 at 00:00 MST
    </time></p>
    <address>
      By           <a href="../author/xin-yang.html">Xin Yang</a>
          <a href="../author/william-qi.html">William Qi</a>
    </address>
    <p>
        Category: <a href="../category/labsignments.html">labsignments</a>
    </p>
    <p>
        Tags:
            <a href="../tag/labs.html">labs</a>
    </p>
  </footer>
  </article>
        </main>
        <footer>
                <address>
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>,
                which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address>
        </footer>
</body>
</html>